---
title: "Inferencia 2: Intervalos de confianza"
date: "2023-10-06"
lang: es
website:
  comments:
    giscus:
      repo: cursos-metodos-facso/correlacional
---

# Objetivo de la práctica

El objetivo de esta guía práctica es continuar adentrándonos en la inferencia estadística, revisando algunos de sus conceptos clave como distribución muestral, error estándar, y la definición y aplicaciones de los intervalos de confianza.

En detalle, aprenderemos:

1.  Qué es una distribución muestral.
2.  Qué es el error estándar.
3.  Qué son y cómo calcular intervalos de conafianza.

# Primero recordemos:

## ¿Qué es la inferencia estadística?

La inferencia estadísticaes el proceso de realizar conclusiones o predicciones sobre una población a partir de una muestra o subconjunto representativo de esa población. En concreto, llamamos inferencia al ejercicio de **extrapolar** determinados valores de una muestra, llamados *estadísticos*, para estimar un *parámetro* de la población.

![](../files/INFERENCIA.jpg)

Un concepto central en todo esto es la probabilidad de *error*, es decir, en qué medida nos estamos equivocando (o estamos dispuestos a estar equivocados) al tratar de extrapolar una estimación muestral a la población.

## ¿Qué es una distribución?

Recordemos que por distribución nos referimos al conjunto de todos los valores posibles de una variable y las frecuencias (o probabilidades) con las que se producen.

Existen **distribuciones empíricas** y **distribuciones teóricas**, en donde:

-   las primeras reflejan la distribución de los valores que asume la variable en un grupo *concreto* a partir de una observación.
-   las segundas son una *función matématica* que expresan la distribución de un conjunto de números mediante su *probabilidad de ocurencia*.

Como vimos en el [práctico 4](/assignment/04-practico.html), una distribuciones teóricas más conocidas: **la distribución normal estándar**.

# Distribución muestral

::: callout-note
**Variabilidad muestral**: el valor de un estadístico varía en un muestreo aleatorio repetido.
:::

La **distribución muestral** es la distribución de las estimaciones, o estadísticos como la media o proporción, tomadas de múltiples muestras aleatorias de una población. Permite comprender cómo varían las estimaciones de una muestra a otra.

**Ejemplo 1**: Imaginemos que tenemos una población de niñ_s de 0 a 9 años, y tomamos múltiples muestras de 6 individu_s (n=6). Cada una de las muestras tendrá un promedio (estadístico muestral, en este caso $\bar{x}$) difernte, que no necesariamente coincidirán con el promedio de la población (parámentro, en este caso $\mu_{x}$)

![](../files/dist_muestral.png)

**Ejemplo 2**: Si usamos valores simulados, podemos ver que todas las medias obtenidas en cada muesta son distintas.

```{r}
set.seed(100)  # Establecer semilla 
muestras <- replicate(100, mean(rnorm(30, mean = 50, sd = 10))) # 100 muestras de tamaño 30
muestras
```

Como se vio en la [sesión 6](/content/06-content.html), si tengo la desviación estándar de los promedios, puedo construir un intervalo de probabilidad, basado en la curva normal (mirar [sesión 5](/content/05-content.html)).

::: callout-note
Una acaracterística importante es que se asume que las muestras tomadas de la población son *aleatorias y representativas*, lo que es esencial para que la distribución muestral refleje adecuadamente la variabilidad de las estimaciones.
:::

La importancia de la distribución muestral es que nos permitirá estimar parámetros poblacionales a partir de estadísticos muestrales, construir intervalos de confianza, y realizar pruebas de hipótesis.

# Error estándar

El error estándar es una medida de la variabilidad de una estimación, proporciona una medida de cuán precisas son nuestras estimaciones de la población. Corresponde a la estimación de la desviación estándar de la muestra.

![](https://multivariada.netlify.app/slides/images/se_1.png)

![](https://multivariada.netlify.app/slides/images/se_2.png)

![](https://multivariada.netlify.app/slides/images/se_3.png)

::: callout-note
**Teorema del límite central** la distribución de los promedios de distintas muestras - o distribución muestral del promedio - se aproxima a una *distribución normal*.
:::

Basados en el teorema del límite central, es posible calcular la desviación estándar del promedio (error estándar) con una sola muestra:

$$\sigma_{\bar{X}}=SE(error estándar)=\frac{s}{\sqrt{N}}$$

```{r}
# Generar una muestra de datos
set.seed(123)  # Establecer semilla 
muestra <- rnorm(100, mean = 50, sd = 10)  # Muestra de tamaño 100, media 50, desviación estándar 10

# Calcular el error estándar
error_estandar <- sd(muestra) / sqrt(length(muestra))
error_estandar
```

La importancia del error estándar es que nos permitirá construir intervalos de confianza, y realizar pruebas de hipótesis.

# Intervalos de confianza

Un intervalo de confianza es un rango dentro del cual es probable que se encuentre un parámetro poblacional con un nivel de confianza específico. Además, proporciona información sobre la precisión de nuestras estimaciones.

Por ejemplo, 

```{r}
# Calcular un intervalo de confianza para la media
intervalo_confianza <- t.test(muestra)$conf.int  # Intervalo de confianza del 95% para la media
intervalo_confianza
```

Como vimos en la [sesión 6](/content/06-content.html) el promedio de la muestra \bar{x} se distruye normal, con un error estándar $SE$, lo que nos permite estimar probabilidades basándonos en la curva normal. 

Por ejemplo, si nos desviamos $1.96SE$ desde la media abarcaremos aproximadamente el 95% de los valores probables.

![](https://multivariada.netlify.app/slides/images/normal.png)

::: callout-note 
**Nivel de confianza**: Corresponde a la probabilidad de que la muestra elegida produzca un intervalo que incluya el parámetro que se está estimando ($1-\alpha$).

**Nivel de significacncia**: Correpsonde a la probabilidad de que el intervalo calculado a partir de la muestra no comprenda el parámetro de la población ($\alpha$).
::: 

## Cálculo de intervalos de confianza

Ahora ¡Manos a la obra!

Calculemos intervalos de confianza. Primero, carguemos las librerías necesarias:

```{r librerias}
library(pacman)
pacman::p_load(tidyverse, # colección de paquetes para manipulación de datos
               car,       # para recodificar
               psych,     # para analizar datos
               sjmisc,    # para analizar datos
               srvyr,     # para estimación de IC y ponderadores
               Publish)   # para IC

options(scipen = 999) # para desactivar notacion cientifica
rm(list = ls()) # para limpiar el entorno de trabajo
```

y también carguemos la base de datos que utilizaremos, que corresponde a un subset de la ESI (https://www.ine.gob.cl/estadisticas/sociales/ingresos-y-gastos/encuesta-suplementaria-de-ingresos) para ocupados:

```{r}
load(url("https://github.com/cursos-metodos-facso/datos-ejemplos/raw/main/esi-2021-ocupados.rdata"))
```

::: callout-note 
Recordemos que podemos contar con bases de datos que tengan factor de expansión (ponderador) o no. Esta distinción se presenta cuando trabajamos con muestras simples o complejas. Al trabajar con muestras complejas debemos identificar cuál es la variable del ponderador e incorporarla en nuestro cálculo, como veremos a continuación.
::: 

### Intervalos de confianza sin ponderador

Podemos calcular intervalos de confianza con muestras representativas sin ponderadores o factores de expansión. Supongamos que es el caso.

#### IC para Medias

Calculemos un intervalo de confianza para la media de ingresos de personas ocupadas:

```{r}
psych::describe(esi$ing_t_p)
```

```{r}
Publish::ci.mean(esi$ing_t_p, alpha = 0.05)
```
Al no aplicar factores de expansión, contamos con una media de ingresos de \$586.360 como estimación puntual. Pero también podemos decir que con un 95% de confianza el parámetro poblacional se encontrará entre \$579.266 y \$593.454.

#### IC para Proporciones

Para calcular un intervalo de confianza para la proporción por la variable sexo, usamos:

```{r}
sjmisc::frq(esi$sexo)
prop.test(x = 20806, n = 37124, conf.level = 0.95)
```

En este caso, sabemos que el total de las personas ocupadas de la muestra son n=37.124, y que la cantidad de hombres son 20.806, correspondientes al 56% como estimación puntual. También podemos sostener con un 95% que la proporción de hombres en la población se encuentra entre 55.54% y 56.6%. 

### Intervalos de confianza con ponderador

Mientras que para las muestras complejas, que cuentan con ponderador (o factor de expansión) también podemos hacer este ejercicio.

Primero, es necesario identificar la variable de factor de expansión o ponderador:
```{r}
esi_pond <- esi %>% as_survey_design(ids = 1, # indica conglomerados de muestreo; ~0 o ~1 cuando no hay
                                     strata = estrato, # indica efecto de diseño muestral
                                     weights = fact_cal_esi) # indica el ponderador

options(survey.lonely.psu = "certainty") # seteamos para que ids no moleste
```


#### IC para Medias

Ahora, teniendo en consideración el factor de expansión, podemos señalar que: 

```{r}
esi_pond %>% 
  summarise(media = survey_mean(ing_t_p, vartype = "ci", levels = 0.95, na.rm=TRUE)) # usamos funcion survey_mean
```

El promedio de ingresos de personas ocupadas ponderado en la población corresponde a \$681.039 como estimación puntual, pero que es posible afirmar con un 95% de confianza que el parámetro poblacional se encuentra entre \$666.562 y \$695.516.

#### IC para Proporciones

Finalmente, si calculamos la proporción de hombres ocupados en la población considerando el factor de expansión:

```{r, message=FALSE}
sjmisc::frq(esi$sexo)
```

```{r, message=FALSE}
esi_pond %>% 
  group_by(sexo) %>% # agrupamos por sexo
  summarise(prop = survey_prop(vartype = "ci", levels = 0.95, na.rm = TRUE))
```

Tenemos que, con un 95% de conafianza, podemos afirmar que la proporción de hombre ocupados se encuentra entre el 57% y 58%.

# Resumen

En esta guía práctica pudimos repasar los conceptos de inferencia estadística y distribución. Y con ello, abordamos las ideas de distribución muestral, error estándar, y la definición y cálculo de intervalos de confianza, tanto para muestras simples como complejas.

En detalle, aprenderemos:

1.  Qué es una distribución muestral.
2.  Qué es el error estándar.
3.  Qué son y cómo calcular intervalos de conafianza.

# Reporte de progreso

Completar el reporte de progreso correspondiente a esta práctica [aquí](https://forms.gle/FMb6eprMxcVAEPV99). El plazo para contestarlo es hasta el día viernes de la semana en la que se publica la práctica correspondiente.

# Video de práctica

<!-- {{< video https://youtu.be/SlcKzUw_jhc >}} -->

# Foro

```{=html}
<script src="https://giscus.app/client.js"
        data-repo="cursos-metodos-facso/correlacional"
        data-repo-id="R_kgDOKCMXJQ"
        data-category="Q&A"
        data-category-id="DIC_kwDOKCMXJc4CYd9S"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="es"
        crossorigin="anonymous"
        async>
</script>
```
